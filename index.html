<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 UFO CUP KOREA</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a1a;
      --surface: #0f1130;
      --surface2: #141840;
      --accent: #00d4ff;
      --accent2: #7c3aed;
      --gold: #fbbf24;
      --green: #10b981;
      --red: #ef4444;
      --text: #e2e8f0;
      --text-dim: #64748b;
      --border: #1e2a5e;
      --glow: 0 0 20px rgba(0,212,255,0.3);
      --glow-gold: 0 0 25px rgba(251,191,36,0.5);
      --bronze: #b45309;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.4) 0%, transparent 100%),
        radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.3) 0%, transparent 100%),
        radial-gradient(1px 1px at 60% 10%, rgba(255,255,255,0.4) 0%, transparent 100%),
        radial-gradient(1px 1px at 80% 80%, rgba(255,255,255,0.3) 0%, transparent 100%),
        radial-gradient(1px 1px at 50% 40%, rgba(255,255,255,0.5) 0%, transparent 100%),
        radial-gradient(1px 1px at 90% 30%, rgba(255,255,255,0.3) 0%, transparent 100%),
        radial-gradient(1px 1px at 20% 90%, rgba(255,255,255,0.4) 0%, transparent 100%),
        radial-gradient(1px 1px at 70% 50%, rgba(255,255,255,0.2) 0%, transparent 100%);
      pointer-events: none; z-index: 0;
    }

    /* â”€â”€ Header â”€â”€ */
    header { text-align:center; padding:28px 20px 16px; position:relative; z-index:2; }
    .ufo-icon { font-size:2.8rem; display:inline-block; animation:float 3s ease-in-out infinite; filter:drop-shadow(0 0 12px var(--accent)); }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    header h1 {
      font-size:clamp(1.4rem,3.5vw,2.6rem); font-weight:900; letter-spacing:4px;
      background:linear-gradient(135deg,var(--accent),var(--accent2),var(--gold));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      margin:6px 0 3px;
    }
    header p { color:var(--text-dim); font-size:0.85rem; letter-spacing:2px; }

    /* â”€â”€ Main Layout â”€â”€ */
    .main-layout {
      display:grid; grid-template-columns:210px 1fr 210px;
      gap:14px; padding:0 14px 40px; position:relative; z-index:2; align-items:start;
    }

    /* â”€â”€ Timer Panel â”€â”€ */
    .timer-panel {
      background:var(--surface); border:1px solid var(--border);
      border-radius:16px; padding:18px 14px; position:sticky; top:16px;
    }
    .timer-panel.left  { border-color:rgba(0,212,255,0.3); }
    .timer-panel.right { border-color:rgba(251,191,36,0.4); }
    .timer-label { font-size:0.7rem; letter-spacing:2px; text-transform:uppercase; text-align:center; margin-bottom:10px; font-weight:700; }
    .timer-panel.left  .timer-label { color:var(--accent); }
    .timer-panel.right .timer-label { color:var(--gold); }
    .timer-name { font-size:0.95rem; font-weight:800; text-align:center; margin-bottom:14px; }
    .timer-display {
      font-size:2.4rem; font-weight:900; text-align:center;
      font-variant-numeric:tabular-nums; letter-spacing:2px; margin-bottom:14px; transition:color 0.3s;
    }
    .timer-panel.left  .timer-display { color:var(--accent); text-shadow:var(--glow); }
    .timer-panel.right .timer-display { color:var(--gold); text-shadow:var(--glow-gold); }
    .timer-display.warning { color:var(--red)!important; animation:pulse-red 0.5s ease infinite alternate; }
    @keyframes pulse-red { from{opacity:1} to{opacity:0.45} }
    .timer-progress { width:100%; height:5px; background:var(--surface2); border-radius:3px; margin-bottom:14px; overflow:hidden; }
    .timer-progress-bar { height:100%; border-radius:3px; transition:width 1s linear; }
    .timer-panel.left  .timer-progress-bar { background:linear-gradient(90deg,var(--accent2),var(--accent)); }
    .timer-panel.right .timer-progress-bar { background:linear-gradient(90deg,var(--bronze),var(--gold)); }
    .timer-btn { display:block; width:100%; padding:8px 10px; border:none; border-radius:8px; font-size:0.8rem; font-weight:700; cursor:pointer; margin-bottom:7px; transition:all 0.2s; }
    .btn-start { background:linear-gradient(135deg,var(--accent2),#4c1d95); color:white; }
    .btn-start:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(124,58,237,0.4); }
    .btn-toggle { background:var(--surface2); color:var(--text-dim); border:1px solid var(--border); }
    .btn-toggle:hover { background:var(--border); color:var(--text); }
    .btn-toggle.active { background:linear-gradient(135deg,#065f46,#047857); color:#6ee7b7; border-color:var(--green); }
    .btn-reset { background:transparent; color:var(--text-dim); border:1px solid var(--border); font-size:0.72rem; }
    .btn-reset:hover { color:var(--red); border-color:var(--red); }

    /* â”€â”€ Tournament Container â”€â”€ */
    .tournament-container { min-width:0; }
    .section-header { display:flex; align-items:center; gap:10px; margin:20px 0 12px; }
    .section-header h2 { font-size:0.95rem; font-weight:800; letter-spacing:3px; text-transform:uppercase; white-space:nowrap; }
    .section-line { flex:1; height:1px; background:linear-gradient(90deg,var(--border),transparent); }
    .badge { font-size:0.65rem; font-weight:700; padding:2px 8px; border-radius:20px; letter-spacing:1px; }
    .badge-qualifier { background:rgba(0,212,255,0.15); color:var(--accent); border:1px solid rgba(0,212,255,0.3); }
    .badge-semi      { background:rgba(124,58,237,0.2); color:#a78bfa;       border:1px solid rgba(124,58,237,0.4); }
    .badge-final     { background:rgba(251,191,36,0.15); color:var(--gold);   border:1px solid rgba(251,191,36,0.4); }

    /* â”€â”€ Qualifier Grid â”€â”€ */
    .qualifier-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }

    /* â”€â”€ Group Card â”€â”€ */
    .group-card {
      background:var(--surface); border:1px solid var(--border);
      border-radius:14px; overflow:hidden; transition:border-color 0.3s;
    }
    .group-card:hover { border-color:rgba(0,212,255,0.2); }
    .group-header { background:var(--surface2); padding:9px 12px; display:flex; align-items:center; justify-content:space-between; }
    .group-title { font-size:0.78rem; font-weight:800; letter-spacing:2px; color:var(--accent); }
    .group-status {
      font-size:0.62rem; padding:2px 7px; border-radius:10px; font-weight:700;
      background:rgba(100,116,139,0.2); color:var(--text-dim);
      border:1px solid rgba(100,116,139,0.3); cursor:pointer; transition:all 0.2s;
    }
    .group-status.done { background:rgba(16,185,129,0.2); color:var(--green); border-color:rgba(16,185,129,0.4); }
    .player-list { padding:7px; }

    /* â”€â”€ Player Row â”€â”€ */
    .player-row {
      display:flex; align-items:center; gap:5px;
      padding:6px 5px; border-radius:8px; margin-bottom:3px;
      transition:all 0.25s; border:1px solid transparent;
    }
    .player-row:last-child { margin-bottom:0; }
    .player-rank {
      width:20px; height:20px; border-radius:50%; display:flex;
      align-items:center; justify-content:center; font-size:0.65rem;
      font-weight:800; flex-shrink:0; background:var(--surface2); color:var(--text-dim);
    }

    /* â”€â”€ Name area â”€â”€ */
    .name-area { flex:1; min-width:0; display:flex; align-items:center; gap:4px; }
    .player-name-display {
      flex:1; font-size:0.84rem; font-weight:600; color:var(--text);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .player-name-display.empty { color:var(--text-dim); font-style:italic; font-weight:400; }
    .player-name-input {
      flex:1; background:rgba(0,212,255,0.07); border:1px solid rgba(0,212,255,0.35);
      border-radius:6px; padding:2px 6px; color:white; font-size:0.84rem; font-weight:600; outline:none; min-width:0;
    }
    .player-name-input:focus { border-color:var(--accent); box-shadow:0 0 6px rgba(0,212,255,0.2); }
    .name-action-btn {
      flex-shrink:0; padding:2px 7px; border-radius:5px; font-size:0.65rem; font-weight:700;
      cursor:pointer; border:1px solid; transition:all 0.18s; white-space:nowrap;
    }
    .btn-save { background:rgba(16,185,129,0.15); color:var(--green); border-color:rgba(16,185,129,0.4); }
    .btn-save:hover { background:rgba(16,185,129,0.3); }
    .btn-edit { background:rgba(0,212,255,0.1); color:var(--accent); border-color:rgba(0,212,255,0.3); }
    .btn-edit:hover { background:rgba(0,212,255,0.22); }

    /* â”€â”€ SPOON SCORE â”€â”€ */
    .spoon-row { display:flex; align-items:center; gap:3px; flex-shrink:0; }
    .spoon {
      font-size:1.1rem; cursor:pointer; transition:all 0.2s;
      filter:grayscale(1) brightness(0.4);
      user-select:none; line-height:1;
    }
    .spoon.active {
      filter:none drop-shadow(0 0 6px #fbbf24) brightness(1.3);
      animation:spoon-glow 0.4s ease;
    }
    @keyframes spoon-glow {
      0%   { transform:scale(1); }
      50%  { transform:scale(1.4) rotate(-15deg); }
      100% { transform:scale(1); }
    }

    /* â”€â”€ Promote btn â”€â”€ */
    .promote-btn {
      width:24px; height:24px; border-radius:6px; flex-shrink:0;
      border:1px solid rgba(251,191,36,0.3); background:rgba(251,191,36,0.1);
      color:var(--gold); font-size:0.75rem; cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s;
    }
    .promote-btn:hover { background:rgba(251,191,36,0.25); box-shadow:0 0 8px rgba(251,191,36,0.3); }

    /* â”€â”€ Player States â”€â”€ */
    .player-row.rank-1st { background:rgba(251,191,36,0.12); border-color:rgba(251,191,36,0.3); }
    .player-row.rank-1st .player-rank { background:var(--gold); color:#1a1a0a; }
    .player-row.eliminated { opacity:0.3; }
    .player-row.advanced   { background:rgba(16,185,129,0.1); border-color:rgba(16,185,129,0.25); }
    .player-row.advanced .player-rank { background:var(--green); color:white; }
    .player-row.editing    { background:rgba(0,212,255,0.06); border-color:rgba(0,212,255,0.2); }

    /* â”€â”€ Flow Arrow â”€â”€ */
    .advance-flow { display:flex; align-items:center; justify-content:center; padding:10px 0; gap:8px; }
    .flow-arrow { font-size:1.4rem; color:var(--accent); animation:bounce-down 1.5s ease infinite; }
    @keyframes bounce-down { 0%,100%{transform:translateY(0);opacity:1} 50%{transform:translateY(6px);opacity:0.5} }
    .flow-text { font-size:0.75rem; letter-spacing:2px; color:var(--text-dim); font-weight:600; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUALIFIER FINALISTS PANEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .finalists-panel {
      background:var(--surface);
      border:1px solid rgba(0,212,255,0.25);
      border-radius:16px; overflow:hidden; margin-bottom:0;
    }
    .finalists-header {
      background:linear-gradient(135deg,rgba(0,212,255,0.15),rgba(124,58,237,0.15));
      padding:12px 18px; display:flex; align-items:center; justify-content:space-between;
    }
    .finalists-header h3 { font-size:0.9rem; font-weight:800; letter-spacing:3px; color:var(--accent); }
    .draw-btn {
      display:flex; align-items:center; gap:6px;
      padding:7px 16px; border-radius:10px; border:none; cursor:pointer;
      background:linear-gradient(135deg,var(--accent2),#4c1d95);
      color:white; font-size:0.8rem; font-weight:800; letter-spacing:1px;
      transition:all 0.25s;
    }
    .draw-btn:hover { transform:translateY(-1px); box-shadow:0 4px 14px rgba(124,58,237,0.5); }
    .draw-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; }
    .draw-dice { font-size:1.2rem; display:inline-block; }
    .draw-btn:not(:disabled):hover .draw-dice { animation:dice-roll 0.5s ease; }
    @keyframes dice-roll {
      0%   { transform:rotate(0deg) scale(1); }
      25%  { transform:rotate(90deg) scale(1.3); }
      50%  { transform:rotate(180deg) scale(1); }
      75%  { transform:rotate(270deg) scale(1.3); }
      100% { transform:rotate(360deg) scale(1); }
    }

    .finalists-grid {
      display:grid; grid-template-columns:repeat(3,1fr); gap:0;
    }
    .finalist-slot {
      padding:10px 12px; border-right:1px solid var(--border); border-bottom:1px solid var(--border);
      display:flex; align-items:center; gap:8px; transition:background 0.3s;
    }
    .finalist-slot:nth-child(3n) { border-right:none; }
    .finalist-slot:nth-child(7),.finalist-slot:nth-child(8),.finalist-slot:nth-child(9) { border-bottom:none; }
    .finalist-slot.empty { opacity:0.4; }
    .finalist-num {
      width:24px; height:24px; border-radius:50%; background:var(--surface2);
      color:var(--text-dim); font-size:0.7rem; font-weight:800;
      display:flex; align-items:center; justify-content:center; flex-shrink:0;
    }
    .finalist-slot.filled .finalist-num { background:var(--accent); color:var(--bg); }
    .finalist-info { flex:1; min-width:0; }
    .finalist-name { font-size:0.84rem; font-weight:700; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .finalist-from { font-size:0.62rem; color:var(--text-dim); letter-spacing:0.5px; margin-top:1px; }
    .finalist-slot.shuffling { animation:slot-flash 0.15s ease infinite alternate; }
    @keyframes slot-flash { from{background:var(--surface2)} to{background:rgba(124,58,237,0.2)} }

    /* â”€â”€ Semi â”€â”€ */
    .semi-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
    .semi-card { background:var(--surface); border:1px solid rgba(124,58,237,0.3); border-radius:14px; overflow:hidden; }
    .semi-header {
      background:linear-gradient(135deg,rgba(124,58,237,0.25),rgba(79,70,229,0.2));
      padding:9px 12px; display:flex; align-items:center; justify-content:space-between;
    }
    .semi-title { font-size:0.76rem; font-weight:800; letter-spacing:2px; color:#a78bfa; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GRAND FINAL â€” SPOON BOXES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .final-stage {
      background:var(--surface); border:1px solid rgba(251,191,36,0.35);
      border-radius:16px; overflow:hidden; box-shadow:0 0 40px rgba(251,191,36,0.07);
    }
    .final-header {
      background:linear-gradient(135deg,rgba(251,191,36,0.2),rgba(180,83,9,0.15));
      padding:13px 18px; text-align:center;
    }
    .final-header h3 {
      font-size:1rem; font-weight:900; letter-spacing:4px;
      background:linear-gradient(90deg,var(--gold),#fde68a,var(--gold));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }
    .final-players { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; padding:14px; }
    .final-player-card {
      background:var(--surface2); border:1px solid var(--border);
      border-radius:12px; padding:18px 12px; text-align:center; transition:all 0.3s;
      position:relative; overflow:hidden;
    }
    .final-player-card::before {
      content:''; position:absolute; inset:0;
      background:radial-gradient(circle at 50% 0%, rgba(251,191,36,0.05), transparent 70%);
      pointer-events:none;
    }
    .final-player-card.champion {
      background:linear-gradient(135deg,rgba(251,191,36,0.2),rgba(180,83,9,0.1));
      border-color:rgba(251,191,36,0.6); box-shadow:var(--glow-gold);
    }
    .final-medal { font-size:1.8rem; margin-bottom:6px; }
    .final-name { font-size:1.05rem; font-weight:800; color:var(--text); margin-bottom:4px; min-height:1.4em; }
    .final-from { font-size:0.65rem; color:var(--text-dim); letter-spacing:1px; margin-bottom:12px; }

    /* Final spoon row */
    .final-spoon-row { display:flex; justify-content:center; gap:6px; margin-bottom:10px; }
    .final-spoon {
      font-size:1.6rem; cursor:pointer; transition:all 0.25s;
      filter:grayscale(1) brightness(0.35);
      user-select:none;
    }
    .final-spoon.active {
      filter:none drop-shadow(0 0 8px #fbbf24) brightness(1.4);
      animation:spoon-glow 0.4s ease;
    }

    .champion-btn {
      margin-top:2px; padding:5px 14px; border-radius:8px;
      border:1px solid rgba(251,191,36,0.4); background:rgba(251,191,36,0.15);
      color:var(--gold); font-size:0.72rem; font-weight:700;
      cursor:pointer; transition:all 0.2s; display:none;
    }
    .champion-btn:hover { background:rgba(251,191,36,0.3); box-shadow:0 0 12px rgba(251,191,36,0.3); }

    /* â”€â”€ Winner Banner â”€â”€ */
    .winner-banner {
      display:none; text-align:center; padding:28px 20px; margin-top:18px;
      background:linear-gradient(135deg,rgba(251,191,36,0.1),rgba(124,58,237,0.1));
      border:2px solid var(--gold); border-radius:20px; animation:glow-pulse 2s ease infinite;
    }
    @keyframes glow-pulse { 0%,100%{box-shadow:0 0 20px rgba(251,191,36,0.3)} 50%{box-shadow:0 0 60px rgba(251,191,36,0.6)} }
    .winner-banner.show { display:block; }
    .winner-banner .trophy { font-size:3.8rem; animation:spin-slow 4s linear infinite; }
    @keyframes spin-slow { from{transform:rotateY(0deg)} to{transform:rotateY(360deg)} }
    .winner-banner h2 { font-size:0.95rem; letter-spacing:4px; color:var(--gold); margin:10px 0 4px; }
    .winner-name {
      font-size:2.2rem; font-weight:900;
      background:linear-gradient(90deg,var(--gold),#fde68a,var(--gold));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }

    /* â”€â”€ Confetti â”€â”€ */
    .confetti-piece {
      position:fixed; width:8px; height:14px; border-radius:2px;
      pointer-events:none; z-index:9999; animation:confetti-fall linear forwards;
    }
    @keyframes confetti-fall {
      0%   { transform:translateY(-20px) rotate(0deg); opacity:1; }
      100% { transform:translateY(110vh) rotate(720deg); opacity:0; }
    }

    /* â”€â”€ Toast â”€â”€ */
    .toast {
      position:fixed; top:20px; left:50%;
      transform:translateX(-50%) translateY(-80px);
      background:linear-gradient(135deg,var(--surface2),var(--surface));
      border:1px solid var(--accent); border-radius:12px;
      padding:10px 22px; font-size:0.88rem; font-weight:700; color:var(--accent);
      z-index:1000; transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
      white-space:nowrap; box-shadow:var(--glow);
    }
    .toast.show { transform:translateX(-50%) translateY(0); }

    /* â”€â”€ Scrollbar â”€â”€ */
    ::-webkit-scrollbar { width:5px; }
    ::-webkit-scrollbar-track { background:var(--bg); }
    ::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width:960px) {
      .main-layout { grid-template-columns:1fr; }
      .timer-panel { position:static; }
      .qualifier-grid,.semi-grid { grid-template-columns:repeat(2,1fr); }
      .final-players,.finalists-grid { grid-template-columns:1fr; }
    }
    @media (max-width:600px) {
      .qualifier-grid,.semi-grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>

<header>
  <div class="ufo-icon">ğŸ›¸</div>
  <h1>2026 UFO CUP KOREA</h1>
  <p>TOURNAMENT BRACKET Â· 36 PLAYERS Â· 9 GROUPS</p>
</header>

<div id="toast" class="toast"></div>

<div class="main-layout">

  <!-- LEFT TIMER -->
  <aside class="timer-panel left">
    <div class="timer-label">â¬› TIMER 1</div>
    <div class="timer-name" style="color:var(--accent)">ì¤€ë¹„ ì‹œê°„</div>
    <div class="timer-display" id="prep-display">05:00</div>
    <div class="timer-progress"><div class="timer-progress-bar" id="prep-bar" style="width:100%"></div></div>
    <button class="timer-btn btn-start"  onclick="timerStart('prep')">â–¶ íƒ€ì´ë¨¸ ì‹œì‘</button>
    <button class="timer-btn btn-toggle" id="prep-toggle" onclick="timerToggle('prep')">â¸ ì¼ì‹œì¤‘ì§€</button>
    <button class="timer-btn btn-reset"  onclick="timerReset('prep')">â†º ë¦¬ì…‹</button>
  </aside>

  <!-- CENTER -->
  <main class="tournament-container">

    <!-- â–‘â–‘ QUALIFIER â–‘â–‘ -->
    <div class="section-header">
      <h2 style="color:var(--accent)">âš¡ ì˜ˆì„  ë¼ìš´ë“œ</h2>
      <span class="badge badge-qualifier">QUALIFIER</span>
      <div class="section-line"></div>
      <span style="font-size:0.72rem;color:var(--text-dim)">ê° ì¡° ìˆ˜ì € ìµœë‹¤ì ë³¸ì„  ì§„ì¶œ</span>
    </div>
    <div class="qualifier-grid" id="qualifier-grid"></div>

    <!-- â–‘â–‘ QUALIFIER FINALISTS â–‘â–‘ -->
    <div class="advance-flow">
      <div class="flow-arrow">â†“</div>
      <div class="flow-text">ì˜ˆì„  9ì¡° 1ìœ„ â†’ ë³¸ì„  ì§„ì¶œ</div>
      <div class="flow-arrow">â†“</div>
    </div>

    <div class="finalists-panel" id="finalists-panel">
      <div class="finalists-header">
        <h3>ğŸ– ë³¸ì„  ì§„ì¶œì (9ëª…)</h3>
        <button class="draw-btn" id="draw-btn" onclick="doShuffle()">
          <span class="draw-dice">ğŸ²</span> ë³¸ì„  ì¶”ì²¨
        </button>
      </div>
      <div class="finalists-grid" id="finalists-grid"></div>
    </div>

    <div class="advance-flow" style="padding:10px 0">
      <div class="flow-arrow" style="color:#a78bfa">â†“</div>
      <div class="flow-text" style="color:#a78bfa">ì¶”ì²¨ í›„ ë³¸ì„  3ì¡° í¸ì„±</div>
      <div class="flow-arrow" style="color:#a78bfa">â†“</div>
    </div>

    <!-- â–‘â–‘ SEMI â–‘â–‘ -->
    <div class="section-header">
      <h2 style="color:#a78bfa">ğŸ† ë³¸ì„  ë¼ìš´ë“œ</h2>
      <span class="badge badge-semi">SEMI-FINAL</span>
      <div class="section-line"></div>
      <span style="font-size:0.72rem;color:var(--text-dim)">3ì¡° ê° ìˆ˜ì € ìµœë‹¤ì ê²°ì„  ì§„ì¶œ</span>
    </div>
    <div class="semi-grid" id="semi-grid"></div>

    <div class="advance-flow">
      <div class="flow-arrow" style="color:var(--gold)">â†“</div>
      <div class="flow-text" style="color:var(--gold)">3ê°œì¡° 1ìœ„ â†’ ìµœì¢… ê²°ì„ </div>
      <div class="flow-arrow" style="color:var(--gold)">â†“</div>
    </div>

    <!-- â–‘â–‘ GRAND FINAL â–‘â–‘ -->
    <div class="section-header">
      <h2 style="color:var(--gold)">ğŸ‘‘ ìµœì¢… ê²°ì„ </h2>
      <span class="badge badge-final">GRAND FINAL</span>
      <div class="section-line"></div>
    </div>
    <div class="final-stage">
      <div class="final-header"><h3>â˜… GRAND FINAL â˜…</h3></div>
      <div class="final-players" id="final-players"></div>
    </div>

    <div class="winner-banner" id="winner-banner">
      <div class="trophy">ğŸ†</div>
      <h2>2026 UFO CUP KOREA</h2>
      <div style="color:var(--text-dim);font-size:0.82rem;letter-spacing:3px;margin-bottom:10px;">CHAMPION</div>
      <div class="winner-name" id="winner-name"></div>
    </div>

  </main>

  <!-- RIGHT TIMER -->
  <aside class="timer-panel right">
    <div class="timer-label" style="color:var(--gold)">â¬› TIMER 2</div>
    <div class="timer-name" style="color:var(--gold)">ì¶”ì¶œ ì‹œê°„</div>
    <div class="timer-display" id="extract-display" style="color:var(--gold)">07:00</div>
    <div class="timer-progress"><div class="timer-progress-bar" id="extract-bar" style="width:100%"></div></div>
    <button class="timer-btn btn-start"  onclick="timerStart('extract')" style="background:linear-gradient(135deg,#92400e,#78350f)">â–¶ íƒ€ì´ë¨¸ ì‹œì‘</button>
    <button class="timer-btn btn-toggle" id="extract-toggle" onclick="timerToggle('extract')">â¸ ì¼ì‹œì¤‘ì§€</button>
    <button class="timer-btn btn-reset"  onclick="timerReset('extract')">â†º ë¦¬ì…‹</button>
  </aside>

</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEFAULT NAMES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DEFAULT_NAMES = [
  ['ê°•ë¯¼ì¤€','ì´ì„œìœ¤','ë°•ì§€í˜¸','ìµœì˜ˆë¦°'],
  ['ì •ìš°ì„±','ê¹€ë‚˜ì—°','ì˜¤ì¤€í˜','ì‹ ì§€ì•„'],
  ['í•œìŠ¹ìš°','ìœ¤ì±„ì›','ì„ë„í˜„','ì¥í•˜ì€'],
  ['ì¡°ë¯¼ì„œ','ë°°ìˆ˜ì§„','ê¶Œíƒœì–‘','ë¥˜ì§€í˜„'],
  ['ë¬¸ì„±ì¤€','ì„œì•„ë¦„','ë…¸íƒœí›ˆ','ì—„ì§€ìˆ˜'],
  ['ì‹¬ì¬ì›','ê³ ì€ë³„','ì•ˆì¤€ì„œ','ë³€í•˜ë¦°'],
  ['ë‚¨ê¸°í›ˆ','í™©ì†Œì—°','ì „ë¯¼ì¬','ì„ë‹¤ì€'],
  ['êµ¬ìí›ˆ','ë§ˆìœ ì§„','ì›ë„ê²½','í‘œë‚˜ë¦¬'],
  ['ë°©ì„±í˜','ì§„ë¯¸ë˜','ì‚¬ê³µì¤€','ë„ì˜ˆì§€'],
];

const MAX_SPOONS    = 3;
const QUAL_GROUPS   = 9;
const QUAL_PER      = 4;
const SEMI_GROUPS   = 3;
const SEMI_PER      = 3;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const state = {
  qualifier: Array.from({length: QUAL_GROUPS}, (_, gi) => ({
    done: false,
    players: Array.from({length: QUAL_PER}, (_, pi) => ({
      name: DEFAULT_NAMES[gi][pi],
      spoons: 0,
      advanced: false,
      eliminated: false,
      editing: false,
    }))
  })),
  // ì˜ˆì„  í†µê³¼ì 9ëª… ìŠ¬ë¡¯ (ìˆœì„œ ì„ì„)
  finalists: Array.from({length: 9}, () => ({ name:'', from:'' })),
  shuffled: false,   // ì¶”ì²¨ ì™„ë£Œ ì—¬ë¶€
  semi: Array.from({length: SEMI_GROUPS}, () => ({
    done: false,
    players: Array.from({length: SEMI_PER}, () => ({
      name: '', spoons: 0, advanced: false, eliminated: false, from:'', editing:false,
    }))
  })),
  final: Array.from({length: 3}, () => ({
    name:'', spoons:0, champion:false, from:'',
  })),
  champion: null,
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER QUALIFIER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderQualifier() {
  const grid = document.getElementById('qualifier-grid');
  grid.innerHTML = '';
  state.qualifier.forEach((group, gi) => {
    const card = document.createElement('div');
    card.className = 'group-card';
    card.id = `q-card-${gi}`;
    card.innerHTML = `
      <div class="group-header">
        <span class="group-title">ì˜ˆì„  ${gi+1}ì¡°</span>
        <span class="group-status${group.done?' done':''}" id="q-status-${gi}"
              onclick="toggleDone('qualifier',${gi})">${group.done?'âœ” ì™„ë£Œ':'ì§„í–‰ì¤‘'}</span>
      </div>
      <div class="player-list" id="q-list-${gi}"></div>
    `;
    grid.appendChild(card);
    const list = card.querySelector(`#q-list-${gi}`);
    group.players.forEach((p, pi) => list.appendChild(buildRow('qualifier', gi, pi, p)));
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER SEMI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSemi() {
  const grid = document.getElementById('semi-grid');
  grid.innerHTML = '';
  state.semi.forEach((group, gi) => {
    const card = document.createElement('div');
    card.className = 'semi-card';
    card.id = `s-card-${gi}`;
    card.innerHTML = `
      <div class="semi-header">
        <span class="semi-title">ë³¸ì„  ${gi+1}ì¡°</span>
        <span class="group-status${group.done?' done':''}" id="s-status-${gi}"
              onclick="toggleDone('semi',${gi})">${group.done?'âœ” ì™„ë£Œ':'ì§„í–‰ì¤‘'}</span>
      </div>
      <div class="player-list" id="s-list-${gi}"></div>
    `;
    grid.appendChild(card);
    const list = card.querySelector(`#s-list-${gi}`);
    group.players.forEach((p, pi) => list.appendChild(buildRow('semi', gi, pi, p)));
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER FINALISTS PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderFinalists() {
  const grid = document.getElementById('finalists-grid');
  grid.innerHTML = '';
  state.finalists.forEach((f, i) => {
    const slot = document.createElement('div');
    slot.className = `finalist-slot${f.name ? ' filled' : ' empty'}`;
    slot.id = `finalist-${i}`;
    slot.innerHTML = `
      <div class="finalist-num">${i+1}</div>
      <div class="finalist-info">
        <div class="finalist-name">${f.name || 'ëŒ€ê¸°ì¤‘â€¦'}</div>
        <div class="finalist-from">${f.from || ''}</div>
      </div>
    `;
    grid.appendChild(slot);
  });
  // draw ë²„íŠ¼ í™œì„±/ë¹„í™œì„±
  const allFilled = state.finalists.every(f => f.name);
  document.getElementById('draw-btn').disabled = !allFilled || state.shuffled;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderFinal() {
  const container = document.getElementById('final-players');
  container.innerHTML = '';
  const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  const labels  = ['ê²°ì„  ì§„ì¶œì 1','ê²°ì„  ì§„ì¶œì 2','ê²°ì„  ì§„ì¶œì 3'];

  state.final.forEach((player, i) => {
    const card = document.createElement('div');
    card.className = `final-player-card${player.champion?' champion':''}`;
    card.id = `f-card-${i}`;

    // spoon row
    let spoonHtml = '<div class="final-spoon-row">';
    for (let s = 0; s < MAX_SPOONS; s++) {
      spoonHtml += `<span class="final-spoon${s < player.spoons?' active':''}"
                         onclick="clickFinalSpoon(${i},${s})">ğŸ¥„</span>`;
    }
    spoonHtml += '</div>';

    card.innerHTML = `
      <div class="final-medal">${player.champion ? 'ğŸ†' : medals[i]}</div>
      <div class="final-name">${player.name || 'â€”'}</div>
      <div class="final-from">${player.from || labels[i]}</div>
      ${spoonHtml}
      <button class="champion-btn" id="f-champ-btn-${i}" onclick="setChampion(${i})">ğŸ‘‘ ìš°ìŠ¹ ì„ ì–¸</button>
    `;
    if (player.name) card.querySelector('.champion-btn').style.display = 'inline-block';
    container.appendChild(card);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD PLAYER ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildRow(stage, gi, pi, player) {
  const row = document.createElement('div');
  let cls = 'player-row';
  if      (player.advanced)   cls += ' advanced';
  else if (player.eliminated) cls += ' eliminated';
  else if (player.editing)    cls += ' editing';
  row.className = cls;
  row.id = `${stage}-${gi}-${pi}`;

  // rank
  const rankEl = document.createElement('div');
  rankEl.className = 'player-rank';
  rankEl.textContent = pi + 1;

  // name area
  const nameArea = document.createElement('div');
  nameArea.className = 'name-area';

  if (player.editing) {
    const inp = document.createElement('input');
    inp.type = 'text'; inp.className = 'player-name-input';
    inp.value = player.name; inp.maxLength = 12;
    inp.placeholder = `ì„ ìˆ˜ ${pi+1}`;
    inp.id = `inp-${stage}-${gi}-${pi}`;
    inp.addEventListener('keydown', e => { if (e.key==='Enter') saveName(stage,gi,pi); });

    const saveBtn = document.createElement('button');
    saveBtn.className = 'name-action-btn btn-save';
    saveBtn.textContent = 'ì €ì¥';
    saveBtn.onclick = () => saveName(stage, gi, pi);

    nameArea.appendChild(inp);
    nameArea.appendChild(saveBtn);
    setTimeout(() => inp.focus(), 40);
  } else {
    const disp = document.createElement('div');
    disp.className = `player-name-display${player.name?'':' empty'}`;
    disp.textContent = player.name || `ì„ ìˆ˜ ${pi+1}`;

    const editBtn = document.createElement('button');
    editBtn.className = 'name-action-btn btn-edit';
    editBtn.textContent = 'ìˆ˜ì •';
    editBtn.onclick = () => startEdit(stage, gi, pi);

    nameArea.appendChild(disp);
    nameArea.appendChild(editBtn);
  }

  // spoons
  const spoonRow = document.createElement('div');
  spoonRow.className = 'spoon-row';
  for (let s = 0; s < MAX_SPOONS; s++) {
    const sp = document.createElement('span');
    sp.className = `spoon${s < player.spoons ? ' active' : ''}`;
    sp.textContent = 'ğŸ¥„';
    sp.onclick = () => clickSpoon(stage, gi, pi, s);
    spoonRow.appendChild(sp);
  }

  // promote (rank 0 only)
  const promBtn = document.createElement('button');
  promBtn.className = 'promote-btn';
  promBtn.title = 'ë‹¤ìŒ ë¼ìš´ë“œ ì§„ì¶œ';
  promBtn.textContent = 'â†‘';
  promBtn.style.visibility = pi === 0 ? 'visible' : 'hidden';
  if (player.advanced) { promBtn.style.background='rgba(16,185,129,0.3)'; promBtn.style.color='#6ee7b7'; }
  promBtn.onclick = () => promotePlayer(stage, gi, pi);

  row.appendChild(rankEl);
  row.appendChild(nameArea);
  row.appendChild(spoonRow);
  row.appendChild(promBtn);
  return row;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPOON CLICK (qualifier / semi)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clickSpoon(stage, gi, pi, spoonIdx) {
  const grp = stage==='qualifier' ? state.qualifier[gi] : state.semi[gi];
  const player = grp.players[pi];
  // toggle: if clicking the last active spoon â†’ turn off; else set to spoonIdx+1
  if (player.spoons === spoonIdx + 1) {
    player.spoons = 0;
  } else {
    player.spoons = spoonIdx + 1;
  }
  refreshRow(stage, gi, pi);
  sortBySpoons(stage, gi);
  saveState();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPOON CLICK (final)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clickFinalSpoon(i, spoonIdx) {
  const player = state.final[i];
  if (player.spoons === spoonIdx + 1) player.spoons = 0;
  else player.spoons = spoonIdx + 1;
  // re-render final spoons only
  const row = document.getElementById(`f-card-${i}`);
  if (!row) return;
  const spans = row.querySelectorAll('.final-spoon');
  spans.forEach((sp, s) => {
    sp.className = `final-spoon${s < player.spoons ? ' active' : ''}`;
  });
  sortFinalBySpoons();
  saveState();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SORT BY SPOONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function sortBySpoons(stage, gi) {
  const grp = stage==='qualifier' ? state.qualifier[gi] : state.semi[gi];
  const sorted = grp.players.map((p,i)=>({p,i})).sort((a,b)=>b.p.spoons - a.p.spoons);
  sorted.forEach(({p,i}, rank) => {
    const row = document.getElementById(`${stage}-${gi}-${i}`);
    if (!row) return;
    let cls = 'player-row';
    if      (p.advanced)   cls += ' advanced';
    else if (p.eliminated) cls += ' eliminated';
    else if (p.editing)    cls += ' editing';
    else if (rank===0 && p.name) cls += ' rank-1st';
    row.className = cls;
    const rEl = row.querySelector('.player-rank');
    if (rEl) rEl.textContent = rank + 1;
  });
}

function sortFinalBySpoons() {
  // visual only â€” gold border on max spoon holder
  const maxSpoons = Math.max(...state.final.map(p=>p.spoons));
  state.final.forEach((p, i) => {
    const card = document.getElementById(`f-card-${i}`);
    if (!card || p.champion) return;
    if (p.spoons === maxSpoons && maxSpoons > 0) {
      card.style.borderColor = 'rgba(251,191,36,0.55)';
      card.style.background  = 'linear-gradient(135deg,rgba(251,191,36,0.12),rgba(180,83,9,0.07))';
    } else {
      card.style.borderColor = '';
      card.style.background  = '';
    }
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAME EDIT / SAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startEdit(stage, gi, pi) {
  const grp = stage==='qualifier' ? state.qualifier[gi] : state.semi[gi];
  grp.players[pi].editing = true;
  refreshRow(stage, gi, pi);
}

function saveName(stage, gi, pi) {
  const inp = document.getElementById(`inp-${stage}-${gi}-${pi}`);
  if (!inp) return;
  const val = inp.value.trim();
  const grp = stage==='qualifier' ? state.qualifier[gi] : state.semi[gi];
  grp.players[pi].name    = val;
  grp.players[pi].editing = false;
  refreshRow(stage, gi, pi);
  sortBySpoons(stage, gi);
  saveState();
  showToast(`âœ… ì €ì¥: ${val || '(ì—†ìŒ)'}`);
}

function refreshRow(stage, gi, pi) {
  const grp  = stage==='qualifier' ? state.qualifier[gi] : state.semi[gi];
  const p    = grp.players[pi];
  const lid  = stage==='qualifier' ? `q-list-${gi}` : `s-list-${gi}`;
  const list = document.getElementById(lid);
  const old  = document.getElementById(`${stage}-${gi}-${pi}`);
  const nw   = buildRow(stage, gi, pi, p);
  if (old && list) list.replaceChild(nw, old);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROMOTE PLAYER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function promotePlayer(stage, gi, pi) {
  if (stage === 'qualifier') {
    const player = state.qualifier[gi].players[pi];
    if (!player.name) { showToast('ì´ë¦„ì„ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.'); return; }

    // push to finalists
    const slot = state.finalists.findIndex(f => !f.name);
    if (slot === -1) { showToast('ì˜ˆì„  ì§„ì¶œìê°€ ì´ë¯¸ 9ëª…ì…ë‹ˆë‹¤.'); return; }

    player.advanced = true;
    state.qualifier[gi].players.forEach((p,i) => { if (i!==pi) p.eliminated = true; });
    state.qualifier[gi].done = true;

    state.finalists[slot].name = player.name;
    state.finalists[slot].from = `ì˜ˆì„  ${gi+1}ì¡° 1ìœ„`;

    renderQualifier();
    renderFinalists();
    saveState();
    showToast(`ğŸ‰ ${player.name} â†’ ë³¸ì„  ì§„ì¶œì ${slot+1}ë²ˆ!`);

  } else if (stage === 'semi') {
    const player = state.semi[gi].players[pi];
    if (!player.name) { showToast('ì´ë¦„ì„ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.'); return; }

    const slot = state.final.findIndex(p => !p.name);
    if (slot === -1) { showToast('ê²°ì„  ìë¦¬ê°€ ëª¨ë‘ ì°¼ìŠµë‹ˆë‹¤.'); return; }

    player.advanced = true;
    state.semi[gi].players.forEach((p,i) => { if (i!==pi) p.eliminated = true; });
    state.semi[gi].done = true;
    state.final[slot].name = player.name;
    state.final[slot].from = `ë³¸ì„  ${gi+1}ì¡° 1ìœ„`;

    renderSemi();
    renderFinal();
    saveState();
    showToast(`ğŸ† ${player.name} â†’ ìµœì¢… ê²°ì„  ì§„ì¶œ!`);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHUFFLE / DRAW (ë³¸ì„  ì¶”ì²¨)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doShuffle() {
  if (state.shuffled) return;
  const btn = document.getElementById('draw-btn');
  btn.disabled = true;

  // Fisher-Yates shuffle
  const arr = [...state.finalists];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }

  // animate slots
  let frame = 0;
  const totalFrames = 20;
  const slots = document.querySelectorAll('.finalist-slot');

  const animate = setInterval(() => {
    slots.forEach(s => s.classList.toggle('shuffling'));
    frame++;
    if (frame >= totalFrames) {
      clearInterval(animate);
      slots.forEach(s => s.classList.remove('shuffling'));

      // apply shuffled order
      state.finalists = arr;
      state.shuffled = true;

      // assign to semi groups (0-2 â†’ S0, 3-5 â†’ S1, 6-8 â†’ S2)
      state.finalists.forEach((f, idx) => {
        const sGi = Math.floor(idx / 3);
        const sPi = idx % 3;
        state.semi[sGi].players[sPi].name = f.name;
        state.semi[sGi].players[sPi].from = f.from;
      });

      renderFinalists();
      renderSemi();
      saveState();
      showToast('ğŸ² ë³¸ì„  ì¶”ì²¨ ì™„ë£Œ! ë³¸ì„  3ì¡°ê°€ í¸ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  }, 80);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOGGLE GROUP DONE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleDone(stage, gi) {
  const grp = stage==='qualifier' ? state.qualifier[gi] : state.semi[gi];
  grp.done = !grp.done;
  const prefix = stage==='qualifier' ? 'q' : 's';
  const el = document.getElementById(`${prefix}-status-${gi}`);
  el.textContent = grp.done ? 'âœ” ì™„ë£Œ' : 'ì§„í–‰ì¤‘';
  el.className = `group-status${grp.done?' done':''}`;
  saveState();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAMPION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setChampion(i) {
  const player = state.final[i];
  if (!player.name) return;
  state.final.forEach((p,idx) => p.champion = idx===i);
  state.champion = player.name;
  renderFinal();
  showWinner(player.name);
  saveState();
}

function showWinner(name) {
  const banner = document.getElementById('winner-banner');
  document.getElementById('winner-name').textContent = name;
  banner.classList.add('show');
  banner.scrollIntoView({behavior:'smooth', block:'center'});
  spawnConfetti();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function spawnConfetti() {
  const colors=['#fbbf24','#00d4ff','#7c3aed','#10b981','#ef4444','#f472b6'];
  for (let i=0;i<90;i++) setTimeout(()=>{
    const el=document.createElement('div');
    el.className='confetti-piece';
    el.style.left=Math.random()*100+'vw';
    el.style.background=colors[Math.floor(Math.random()*colors.length)];
    el.style.animationDuration=(2+Math.random()*2)+'s';
    el.style.animationDelay=(Math.random()*0.5)+'s';
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),5000);
  }, i*30);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  clearTimeout(t._tid);
  t._tid=setTimeout(()=>t.classList.remove('show'),3000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const timers = {
  prep:    {total:5*60,remaining:5*60,interval:null,running:false},
  extract: {total:7*60,remaining:7*60,interval:null,running:false},
};
function timerStart(id){
  const t=timers[id]; if(t.running)return;
  if(t.remaining<=0) timerReset(id);
  t.running=true;
  const btn=document.getElementById(`${id}-toggle`);
  btn.textContent='â¸ ì¼ì‹œì¤‘ì§€'; btn.classList.add('active');
  t.interval=setInterval(()=>tickTimer(id),1000);
}
function timerToggle(id){
  const t=timers[id]; const btn=document.getElementById(`${id}-toggle`);
  if(t.running){
    clearInterval(t.interval); t.running=false;
    btn.textContent='â–¶ ì¬ê°œ'; btn.classList.remove('active');
  } else {
    if(t.remaining<=0)return; t.running=true;
    btn.textContent='â¸ ì¼ì‹œì¤‘ì§€'; btn.classList.add('active');
    t.interval=setInterval(()=>tickTimer(id),1000);
  }
}
function timerReset(id){
  const t=timers[id]; clearInterval(t.interval); t.running=false; t.remaining=t.total;
  const btn=document.getElementById(`${id}-toggle`);
  btn.textContent='â¸ ì¼ì‹œì¤‘ì§€'; btn.classList.remove('active');
  document.getElementById(`${id}-display`).classList.remove('warning');
  updateTimerDisplay(id);
}
function tickTimer(id){
  const t=timers[id];
  if(t.remaining>0){ t.remaining--; updateTimerDisplay(id); }
  else {
    clearInterval(t.interval); t.running=false;
    const btn=document.getElementById(`${id}-toggle`);
    btn.textContent='â¸ ì¼ì‹œì¤‘ì§€'; btn.classList.remove('active');
    document.getElementById(`${id}-display`).classList.add('warning');
    showToast(id==='prep'?'â° ì¤€ë¹„ ì‹œê°„ ì¢…ë£Œ!':'â° ì¶”ì¶œ ì‹œê°„ ì¢…ë£Œ!');
  }
}
function updateTimerDisplay(id){
  const t=timers[id];
  const m=String(Math.floor(t.remaining/60)).padStart(2,'0');
  const s=String(t.remaining%60).padStart(2,'0');
  const display=document.getElementById(`${id}-display`);
  display.textContent=`${m}:${s}`;
  document.getElementById(`${id}-bar`).style.width=(t.remaining/t.total*100)+'%';
  if(t.remaining<=30&&t.remaining>0) display.classList.add('warning');
  else display.classList.remove('warning');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCAL STORAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveState(){
  try {
    localStorage.setItem('ufo2026_v3', JSON.stringify({
      qualifier: state.qualifier,
      finalists: state.finalists,
      shuffled:  state.shuffled,
      semi:      state.semi,
      final:     state.final,
      champion:  state.champion,
    }));
  } catch(e){}
}
function loadState(){
  try {
    const raw=localStorage.getItem('ufo2026_v3');
    if(!raw) return;
    const s=JSON.parse(raw);
    if(s.qualifier) state.qualifier=s.qualifier;
    if(s.finalists) state.finalists=s.finalists;
    if(s.shuffled  !== undefined) state.shuffled=s.shuffled;
    if(s.semi)      state.semi=s.semi;
    if(s.final)     state.final=s.final;
    if(s.champion)  state.champion=s.champion;
  } catch(e){}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init(){
  loadState();
  renderQualifier();
  renderFinalists();
  renderSemi();
  renderFinal();
  for(let gi=0;gi<QUAL_GROUPS;gi++) sortBySpoons('qualifier',gi);
  for(let gi=0;gi<SEMI_GROUPS;gi++) sortBySpoons('semi',gi);
  sortFinalBySpoons();
  if(state.champion) setTimeout(()=>showWinner(state.champion),300);
}

init();
</script>
</body>
</html>
